<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adivina la Canci√≥n</title>
    <meta name="theme-color" content="#3b1b52">
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css"> 
</head>
<body>
    <button class="hamburger-btn" type="button" onclick="toggleHamburgerMenu()" aria-label="Abrir men√∫">‚ò∞</button>
    <div id="home-screen" class="screen active">
        <img src="img/adivina.png" alt="Logotipo de Adivina la Canci√≥n" class="logo">
        <button class="btn" onclick="showScreen('login-screen')">Jugar</button>
    </div>

    <div id="login-screen" class="screen">
        <h2>Iniciar Sesi√≥n</h2>
        <input type="email" id="login-email" class="text-input" placeholder="Correo electr√≥nico">
        <div class="password-field">
            <input type="password" id="login-password" class="text-input" placeholder="Contrase√±a">
            <button class="btn icon-btn" type="button" onclick="togglePasswordVisibility('login-password', this)">üëÅÔ∏è</button>
        </div>
        <button class="btn" onclick="loginUser()">Entrar</button>
        <button class="btn tertiary small-link" type="button" onclick="showPasswordRecoveryInfo()">¬øOlvidaste tu contrase√±a?</button>
        <p class="small-text">¬øNo tienes cuenta? <a href="#" onclick="showScreen('register-screen')">Reg√≠strate aqu√≠</a></p>
    </div>

    <div id="register-screen" class="screen">
        <h2>Registro</h2>
        <input type="email" id="register-email" class="text-input" placeholder="Correo electr√≥nico">
        <div class="password-field">
            <input type="password" id="register-password" class="text-input" placeholder="Contrase√±a">
            <button class="btn icon-btn" type="button" onclick="togglePasswordVisibility('register-password', this)">üëÅÔ∏è</button>
        </div>
        <button class="btn" onclick="registerUser()">Registrar</button>
        <p class="small-text">¬øYa tienes cuenta? <a href="#" onclick="showScreen('login-screen')">Inicia sesi√≥n</a></p>
    </div>

    <div id="set-player-name-screen" class="screen">
        <div id="set-player-game-info" style="margin-bottom: 15px;">
        </div>
        <h2>Nombre de Jugador</h2>
        <input type="text" id="player-name-input" class="text-input" placeholder="Introduce tu nombre de jugador">
        <button class="btn" onclick="setPlayerName()">Continuar</button>
    </div>

    <div id="decade-selection-screen" class="screen">
        <button class="bell-btn" type="button" onclick="toggleNotificationsPanel()" aria-label="Ver notificaciones">üîî</button>
        <h2>Selecciona una d√©cada</h2>
        <div id="decade-buttons" class="button-container"></div>

        <button id="summer-songs-btn" class="category-btn" onclick="startSummerSongsGame()">Canciones del Verano</button>
        <button class="btn tertiary" onclick="showOnlineMenu()">Jugar Online</button>
    </div>


    <div id="category-screen" class="screen">
        <h2 id="category-screen-title">Elige una Categor√≠a (<span id="selected-decade-display"></span>)</h2>
        <div id="category-buttons"></div>
        <button class="btn secondary" onclick="showScreen('decade-selection-screen')">Volver a D√©cadas</button>
    </div>

    <div id="online-mode-screen" class="screen">
        <h2>Jugar Online</h2>
        <button class="btn" onclick="showScreen('create-online-screen')">Crear Partida</button>
        <button class="btn" onclick="showScreen('pending-games-screen')">Ver Partidas Recibidas <span id="online-invite-count" class="badge" hidden>0</span></button>
        <button class="btn" onclick="showScreen('join-online-screen')">Unirse a Partida</button>
        <button class="btn" onclick="showScreen('invite-online-screen')">Invitar por Nombre</button>
        <button class="btn secondary" onclick="showScreen('decade-selection-screen')">Volver</button>
        
        
    </div>

    <div id="create-online-screen" class="screen">
        <h2>Crear Partida Online</h2>
        <p>Selecciona d√©cada y categor√≠a:</p>
        <select id="online-decade-select" class="text-input"></select>
        <select id="online-category-select" class="text-input"></select>
        <button class="btn" onclick="createOnlineGame()">Crear y Compartir C√≥digo</button>
        <button class="btn secondary" onclick="showScreen('online-mode-screen')">Volver</button>
    </div>

    <div id="join-online-screen" class="screen">
        <h2>Unirse a Partida</h2>
        <input type="text" id="join-code-input" class="text-input" placeholder="C√≥digo de Partida">
        <button class="btn" onclick="joinOnlineGame()">Unirse</button>
        <button class="btn secondary" onclick="showScreen('online-mode-screen')">Volver</button>
    </div>

    <div id="invite-online-screen" class="screen">
        <h2>Invitar a Jugador</h2>
        <input type="text" id="rival-name-input" class="text-input" placeholder="Nombre del rival">
        <select id="invite-decade-select" class="text-input"></select>
        <select id="invite-category-select" class="text-input"></select>
        <button class="btn" onclick="invitePlayerByName()">Invitar</button>
        <button class="btn secondary" onclick="showScreen('online-mode-screen')">Volver</button>
    </div>

    <div id="pending-games-screen" class="screen">
        <h2>Mis Partidas Online</h2>

        <div id="active-games-section" style="margin-bottom: 30px;">
            <h3>Partidas Activas y Pendientes</h3>
            <div id="active-games-list">
                <p>Cargando partidas activas...</p>
            </div>
        </div>

        <div id="finished-games-section">
            <h3>Partidas Finalizadas</h3>
            <div id="finished-games-list">
                <p>Cargando partidas finalizadas...</p>
            </div>
        </div>

        <button class="btn danger" onclick="confirmClearOnlineGameHistory()" style="margin-top: 20px;">Borrar Historial Online</button>
        <button class="btn secondary" onclick="showScreen('online-mode-screen')">Volver</button>
    </div>


    <div id="online-wait-screen" class="screen">
        <h2>Esperando al Otro Jugador...</h2>
        <p id="online-status-text">Una vez ambos hayan terminado, ver√°s el resultado.</p>
        <button class="btn secondary" onclick="goToOnlineMenu()">Volver al Men√∫ Online</button>
        <button class="btn tertiary" onclick="endOnlineModeAndGoHome()">Men√∫ Principal</button>
    </div>

    <div id="statistics-screen" class="screen">
        <h2>Mis Estad√≠sticas</h2>
        <div id="user-total-scores" style="margin-bottom: 20px;">
            <h3>Puntos Acumulados por D√©cada y Categor√≠a</h3>
            <div id="category-scores-list">
                <p>Cargando estad√≠sticas...</p>
            </div>
        </div>

        <div id="duel-history">
            <h3>Historial de Duelos (2 Jugadores)</h3>
            <div id="duel-list">
                <p>Cargando historial...</p>
            </div>
        </div>

        <p class="small-text" style="margin-top: 16px;">Si borras las estad√≠sticas, comenzar√°n de cero desde este momento y no podr√°s recuperar las actuales.</p>
        <button class="btn secondary" onclick="confirmResetStatistics()">Borrar estad√≠sticas</button>
        <button class="btn secondary" onclick="showScreen('decade-selection-screen')">Volver</button>
    </div>

    <div id="songs-list-category-screen" class="screen">
        <h2>Listado de Canciones por Categor√≠a y D√©cada</h2>
        <div id="songs-list-category-buttons"></div>
        <button class="btn secondary" onclick="showScreen('decade-selection-screen')">Volver</button>
    </div>

    <div id="songs-list-display-screen" class="screen">
        <h2 id="songs-list-category-title"></h2>

        <div id="songs-list-scroll-content">
            <div id="songs-list-container">
                <p>Cargando canciones...</p>
            </div>
        </div>
        <button class="btn secondary" onclick="showSongsListCategorySelection()" style="margin-top: 20px;">Volver a Categor√≠as de Canciones</button>
        <button class="btn secondary" onclick="showScreen('category-screen')">Volver al Men√∫ Principal</button>
    </div>

    <div id="player-selection-screen" class="screen">
        <h2>Introduce el n√∫mero de jugadores</h2>
        <div class="player-selection-grid">
            <button class="player-btn" onclick="selectPlayers(1)">1 Jugador</button>
            <button class="player-btn" onclick="selectPlayers(2)">2 Jugadores</button>
            <button class="player-btn" onclick="selectPlayers(3)">3 Jugadores</button>
            <button class="player-btn" onclick="selectPlayers(4)">4 Jugadores</button>
            <button class="player-btn" onclick="selectPlayers(5)">5 Jugadores</button>
            <button class="player-btn" onclick="selectPlayers(6)">6 Jugadores</button>
        </div>
        <button class="btn secondary" onclick="confirmReturnToMenu()" style="margin-top: 20px;">Men√∫ Principal</button>
    </div>
    <div id="player-names-input-screen" class="screen">
        <h2>Nombres de los Jugadores</h2>
        <p class="small-text">El primer jugador es tu usuario logueado: <strong id="logged-in-player-name"></strong></p>
        <div id="other-player-names-inputs"></div>
        <button class="btn" onclick="startGame()">Comenzar Partida</button>
        <button class="btn secondary" onclick="showScreen('player-selection-screen')">Volver a selecci√≥n de jugadores</button>
    </div>

    <div id="player-transition-screen" class="screen">
        <h2>Turno Terminado</h2>
        <p id="current-player-score-summary" style="font-size: 1.3rem; margin-bottom: 20px; color: var(--warning-color);"></p>
        <h3 id="next-player-prompt" style="color: var(--secondary-color); margin-bottom: 30px;"></h3>
        <button class="btn" onclick="continueToNextPlayerTurn()">Comenzar</button>
    </div>

    <div id="game-screen" class="screen">
        <div id="game-info" style="margin-bottom: 15px;">
            <strong>Turno de:</strong> <span id="player-name-display"></span>
        </div>

        <div class="game-header">
            <div class="game-info">
                <div id="category-display"></div>
                <div id="question-counter"></div>
            </div>
            <div class="game-score">
                <span id="attempts-counter" class="attempts-counter"></span>
                <div id="points-display"></div>
            </div>
        </div>
        <h3 id="player-turn"></h3>
        <button id="play-song-btn" class="btn">‚ñ∂</button>
        <div id="answer-buttons"></div>
        <button class="btn secondary" onclick="confirmReturnToMenu()" style="margin-top: 20px;">Men√∫ Principal</button>
    </div>
    <div id="end-game-screen" class="screen">
        <h2>Partida Terminada</h2>
        <div id="winner-display"></div>
        <div id="final-scores"></div>
        <button class="btn" id="play-again-btn">Volver a Jugar</button>
        <button class="btn secondary" id="online-menu-btn" onclick="goToOnlineMenu()">Volver al Men√∫ Online</button>
    </div>

    <div id="elderly-mode-intro-screen" class="screen">
        <img src="img/adivina.png" alt="Logotipo de Adivina la Canci√≥n" class="logo">
        <h2>Modo F√°cil</h2>
        <p class="small-text">Bienvenido al juego simplificado. Introduce los nombres de los jugadores.</p>
        <input type="text" id="elderly-player-1-name" class="text-input" placeholder="Nombre del Jugador 1">
        <div id="elderly-other-player-names-inputs"></div>
        
    <div class="player-selection-grid" style="margin-top: 20px;">
        <button class="player-btn" onclick="addElderlyPlayerInput(1)">1 Jugador</button>
        <button class="player-btn" onclick="addElderlyPlayerInput(2)">2 Jugadores</button>
        <button class="player-btn" onclick="addElderlyPlayerInput(3)">3 Jugadores</button>
        <button class="player-btn" onclick="addElderlyPlayerInput(4)">4 Jugadores</button>
    </div>
    <button class="btn" onclick="startElderlyModeGame()" style="margin-top: 20px;">Comenzar Partida</button>
</div>

    <audio id="audio-player"></audio>
    <audio id="sfx-acierto" src="audio/sfx/acierto.mp3"></audio>
    <audio id="sfx-error" src="audio/sfx/error.mp3"></audio>

    <div id="premium-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="premium-modal-title">
        <div class="modal-content">
            <h3 id="premium-modal-title">Contenido premium</h3>
            <p id="premium-modal-message">Contenido premium. Pr√≥ximamente disponible mediante desbloqueo.</p>
            <button class="btn secondary" type="button" onclick="closePremiumModal()">Cerrar</button>
        </div>
    </div>

    <div id="instructions-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="instructions-modal-title">
        <div class="modal-content">
            <h3 id="instructions-modal-title">Instrucciones</h3>
            <div class="modal-body">
                <p class="modal-section-title">üéµ ¬øC√ìMO JUGAR A ADIVINA LA CANCI√ìN?</p>

                <p class="modal-section-title">1. Inicio y acceso</p>
                <p>Para jugar necesitas iniciar sesi√≥n o registrarte. Tus datos se guardan en el dispositivo, por lo que no tendr√°s que registrarte cada vez que entres.</p>
                <p>Desde el men√∫ principal podr√°s:</p>
                <ul>
                    <li>Iniciar una nueva partida.</li>
                    <li>Volver a jugar tras terminar una sesi√≥n.</li>
                    <li>Acceder a modos online y estad√≠sticas.</li>
                </ul>

                <p class="modal-section-title">2. Selecci√≥n de categor√≠a</p>
                <p>Elige la categor√≠a musical en la que quieres jugar.</p>
                <p><strong>Categor√≠as disponibles</strong></p>
                <ul>
                    <li>Canciones en Espa√±ol ‚úÖ (gratuita)</li>
                    <li>Canciones en Ingl√©s ‚úÖ (gratuita)</li>
                </ul>
                <p>Estas categor√≠as est√°n disponibles por d√©cada (80, 90, 2000, 2010 y Actual).</p>
                <p><strong>Contenido premium üîí</strong></p>
                <p>Las siguientes categor√≠as requieren desbloqueo:</p>
                <ul>
                    <li>Bandas Sonoras de Pel√≠culas</li>
                    <li>Bandas Sonoras de Series</li>
                    <li>Programas de TV</li>
                    <li>Series Infantiles</li>
                    <li>Anuncios</li>
                    <li>Modos especiales como ‚ÄúTodas las D√©cadas‚Äù o ‚ÄúCanciones del Verano‚Äù</li>
                </ul>
                <p>El desbloqueo es permanente y ampl√≠a la experiencia de juego.</p>

                <p class="modal-section-title">3. Selecci√≥n de jugadores</p>
                <p>Puedes jugar:</p>
                <ul>
                    <li>En solitario</li>
                    <li>De 2 a 6 jugadores en modo local</li>
                </ul>
                <p>En partidas multijugador local:</p>
                <ul>
                    <li>Los turnos se realizan de forma secuencial.</li>
                    <li>Cada jugador tiene su propia puntuaci√≥n.</li>
                    <li>Gana quien m√°s puntos consiga al final.</li>
                </ul>

                <p class="modal-section-title">4. Desarrollo de la partida</p>
                <p>Cada partida consta de 10 preguntas. En cada pregunta:</p>
                <ul>
                    <li>Se reproduce un fragmento de audio.</li>
                    <li>El jugador dispone de hasta 3 intentos para adivinar la canci√≥n.</li>
                </ul>
                <p>En cada intento se escucha un fragmento m√°s largo del audio:</p>
                <ul>
                    <li>Primer intento: 4 segundos</li>
                    <li>Segundo intento: 6 segundos</li>
                    <li>Tercer intento: 10 segundos</li>
                </ul>
                <p>Tras cada intento fallido, la puntuaci√≥n posible se reduce.</p>

                <p class="modal-section-title">5. Sistema de puntuaci√≥n</p>
                <p>La puntuaci√≥n depende del intento en el que aciertes:</p>
                <ul>
                    <li>‚úÖ Primer intento ‚Üí 3 puntos</li>
                    <li>‚úÖ Segundo intento ‚Üí 2 puntos</li>
                    <li>‚úÖ Tercer intento ‚Üí 1 punto</li>
                    <li>‚ùå Sin acierto ‚Üí 0 puntos</li>
                </ul>
                <p>La puntuaci√≥n se actualiza en tiempo real durante la partida.</p>

                <p class="modal-section-title">6. Interfaz durante el juego</p>
                <p>Durante la partida dispondr√°s de:</p>
                <ul>
                    <li>Bot√≥n para reproducir el audio.</li>
                    <li>Opciones de respuesta claras y accesibles.</li>
                    <li>Acceso al men√∫.</li>
                </ul>
                <p>Siempre ver√°s en pantalla:</p>
                <ul>
                    <li>N√∫mero de pregunta.</li>
                    <li>Intentos restantes.</li>
                    <li>Puntuaci√≥n actual.</li>
                </ul>
                <p>El dise√±o est√° optimizado para pantallas t√°ctiles.</p>

                <p class="modal-section-title">7. Duelos Online üåê</p>
                <p>Tambi√©n puedes jugar contra otros jugadores online.</p>
                <p><strong>Opciones disponibles</strong></p>
                <ul>
                    <li>Crear partida online.</li>
                    <li>Unirse a una partida.</li>
                    <li>Invitar por c√≥digo de invitaci√≥n.</li>
                    <li>Invitar por nombre de usuario.</li>
                    <li>Ver partidas recibidas.</li>
                </ul>
                <p>En los duelos online:</p>
                <ul>
                    <li>Cada jugador juega cuando quiere, desde su dispositivo.</li>
                    <li>Las partidas pueden ser secuenciales o no, seg√∫n disponibilidad.</li>
                    <li>No es necesario que todos los jugadores jueguen al mismo tiempo.</li>
                    <li>Ambos jugadores reciben las mismas canciones y en el mismo orden.</li>
                    <li>El sistema registra autom√°ticamente los resultados.</li>
                    <li>Gana el jugador que obtenga mayor puntuaci√≥n.</li>
                </ul>

                <p class="modal-section-title">8. Final de la partida</p>
                <p>Al finalizar las 10 preguntas:</p>
                <ul>
                    <li>Se muestra un resumen completo de la partida.</li>
                    <li>En multijugador, se indica claramente el ganador.</li>
                </ul>
                <p>Opciones disponibles:</p>
                <ul>
                    <li>Volver a jugar.</li>
                    <li>Cambiar de categor√≠a.</li>
                    <li>Volver al men√∫ principal.</li>
                    <li>Salir del juego.</li>
                </ul>

                <p class="modal-section-title">‚≠ê Consejo</p>
                <p>Empieza con las categor√≠as gratuitas para familiarizarte con el juego y, si te gusta, desbloquea nuevas categor√≠as para ampliar el reto y la diversi√≥n.</p>
                <p>¬°Demuestra cu√°nto sabes de m√∫sica y reta a tus amigos! üé∂üéâ</p>
            </div>
            <button class="btn secondary" type="button" onclick="closeInstructions()">Cerrar</button>
        </div>
    </div>

    <div id="notifications-panel" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="notifications-title">
        <div class="modal-content">
            <h3 id="notifications-title">Notificaciones</h3>
            <div id="notifications-list" class="modal-body"></div>
            <button class="btn secondary" type="button" onclick="toggleNotificationsPanel()">Cerrar</button>
        </div>
    </div>

    <div id="app-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="app-modal-title">
        <div class="modal-content">
            <h3 id="app-modal-title">Aviso</h3>
            <p id="app-modal-message" class="modal-body"></p>
            <div class="modal-actions">
                <button class="btn" id="app-modal-confirm" type="button">Aceptar</button>
                <button class="btn secondary" id="app-modal-cancel" type="button">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="hamburger-menu" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="hamburger-menu-title">
        <div class="modal-content">
            <h3 id="hamburger-menu-title">Men√∫</h3>
            <div class="modal-body">
                <button class="btn secondary" type="button" onclick="showStats()">Estad√≠sticas</button>
                <button class="btn secondary" type="button" onclick="showAllSongs()">Canciones</button>
                <button class="btn secondary" type="button" onclick="showInstructions()">Instrucciones</button>
                <button class="btn secondary" type="button" onclick="showPasswordRecoveryInfo()">Recuperar contrase√±a</button>
                <button class="btn secondary" type="button" onclick="showChangePasswordModal()">Cambiar contrase√±a</button>
                <button class="btn secondary" type="button" onclick="endOnlineModeAndGoHome()">Men√∫ Principal</button>
                <button class="btn tertiary" type="button" onclick="exitGame()">Salir del Juego</button>
            </div>
            <button class="btn" type="button" onclick="closeHamburgerMenu()">Cerrar</button>
        </div>
    </div>

    <div id="password-reset-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="password-reset-title">
        <div class="modal-content">
            <h3 id="password-reset-title">Recuperar contrase√±a</h3>
            <div class="modal-body">
                <input type="email" id="password-reset-email" class="text-input" placeholder="Correo electr√≥nico">
                <button class="btn secondary" type="button" onclick="requestPasswordReset()">Enviar token</button>
                <p id="password-reset-token-info" class="small-text" style="margin-top: 8px;"></p>
                <input type="text" id="password-reset-token" class="text-input" placeholder="Token de recuperaci√≥n">
                <input type="password" id="password-reset-new-password" class="text-input" placeholder="Nueva contrase√±a">
                <input type="password" id="password-reset-confirm-password" class="text-input" placeholder="Repite la nueva contrase√±a">
                <button class="btn" type="button" onclick="confirmPasswordReset()">Cambiar contrase√±a</button>
            </div>
            <button class="btn secondary" type="button" onclick="closePasswordResetModal()">Cerrar</button>
        </div>
    </div>

    <div id="password-change-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="password-change-title">
        <div class="modal-content">
            <h3 id="password-change-title">Cambiar contrase√±a</h3>
            <div class="modal-body">
                <input type="password" id="password-change-current" class="text-input" placeholder="Contrase√±a actual">
                <input type="password" id="password-change-new" class="text-input" placeholder="Nueva contrase√±a">
                <input type="password" id="password-change-confirm" class="text-input" placeholder="Repite la nueva contrase√±a">
                <button class="btn" type="button" onclick="changePassword()">Actualizar contrase√±a</button>
            </div>
            <button class="btn secondary" type="button" onclick="closeChangePasswordModal()">Cerrar</button>
        </div>
    </div>

    <script src="js/songs-loader.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
